<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SDEV255 - PHP - Redirect After POST</title>
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://mpjovanovich.github.io/course-notes/assets/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://mpjovanovich.github.io/course-notes/assets/images/favicon-16x16.png"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,400;0,700;1,400;1,700&family=Roboto:ital,wght@0,400;1,400;1,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;1,400;1,700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://mpjovanovich.github.io/course-notes/assets/css/styles.css"
    />
    <link
      rel="stylesheet"
      href="https://mpjovanovich.github.io/course-notes/assets/css/highlight.css"
    />
  </head>
  <body>
    <h1 class="breadcrumb">
      <a href="https://mpjovanovich.github.io/course-notes/SDEV255/index.html"
        >SDEV255</a
      >&nbsp;&gt;&nbsp;<a href="">PHP - Redirect After POST</a>
    </h1>
    <ul>
      <li>
        <a href="#the-redirect-after-post-rap-pattern"
          >The Redirect After POST (RAP) Pattern</a
        >
        <ul>
          <li><a href="#pattern">Pattern</a></li>
          <li><a href="#benefits">Benefits:</a></li>
          <li><a href="#example">Example</a></li>
          <li><a href="#pages">Pages</a></li>
          <li><a href="#flow">Flow</a></li>
          <li><a href="#code">Code</a></li>
        </ul>
      </li>
    </ul>
    <h1 id="the-redirect-after-post-rap-pattern">
      The Redirect After POST (RAP) Pattern
    </h1>
    <h2 id="pattern">Pattern</h2>
    <ol>
      <li>User submits form.</li>
      <li>Server processes form data.</li>
      <li>Server issues redirect response.</li>
      <li>User browser makes GET request to redirect URL.</li>
      <li>Server responds with result page.</li>
    </ol>
    <h2 id="benefits-">Benefits:</h2>
    <ul>
      <li>Prevents duplicate form submissions if page refreshed.</li>
      <li>Clean URL in browser address bar.</li>
      <li>Separates form processing from form presentation.</li>
    </ul>
    <h2 id="example">Example</h2>
    <h2 id="pages">Pages</h2>
    <p>We will use three pages:</p>
    <ol>
      <li><code>index.php</code> - Form page.</li>
      <li><code>process.php</code> - Process form data.</li>
      <li><code>result.php</code> - Display result.</li>
    </ol>
    <h2 id="flow">Flow</h2>
    <ul>
      <li>From form page, submit to process page.</li>
      <li>If errors, redirect back to form page with error message.</li>
      <li>If no errors, redirect to result page.</li>
    </ul>
    <h2 id="code">Code</h2>
    <p><strong>index.php</strong></p>
    <pre><code class="language-php"><span class="hljs-meta">&lt;?php</span>
    <span class="hljs-comment">// Display validation errors if any were set.</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'error'</span>])) {
        <span class="hljs-keyword">echo</span> $_GET[<span class="hljs-string">'error'</span>];
    }
<span class="hljs-meta">?&gt;</span>
&lt;form action=<span class="hljs-string">"result.php"</span> method=<span class="hljs-string">"POST"</span>&gt;
  &lt;input type=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"name"</span> /&gt;
  &lt;input type=<span class="hljs-string">"submit"</span> value=<span class="hljs-string">"Submit"</span> /&gt;
&lt;/form&gt;
</code></pre>
    <p><strong>process.php</strong></p>
    <pre><code class="language-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/* *****************************************************************
 * REDIRECT TO FORM IF NOT POST
* *****************************************************************/</span>
<span class="hljs-comment">// Users should not be able to access this page directly (via GET)</span>
<span class="hljs-keyword">if</span> ($_SERVER[<span class="hljs-string">'REQUEST_METHOD'</span>] !== <span class="hljs-string">'POST'</span>) {
    header(<span class="hljs-string">'Location: index.php'</span>);
    <span class="hljs-keyword">exit</span>();
}

<span class="hljs-comment">/* *****************************************************************
 * DO VALIDATION
* *****************************************************************/</span>
$error = <span class="hljs-string">''</span>;

<span class="hljs-comment">// We can check for errors in many ways - for this example we'll</span>
<span class="hljs-comment">// assume that we've populated this error variable with a string if</span>
<span class="hljs-comment">// there is an error...</span>

<span class="hljs-comment">/* *****************************************************************
 * REDIRECT TO FORM IF ERRORS
* *****************************************************************/</span>
<span class="hljs-keyword">if</span> ($error) {
    header(<span class="hljs-string">'Location: index.php?error='</span> . $error);
    <span class="hljs-keyword">exit</span>;
}

<span class="hljs-comment">/* *****************************************************************
 * PROCEED TO RESULT PAGE
* *****************************************************************/</span>
header(<span class="hljs-string">'Location: result.php?name='</span> . $_POST[<span class="hljs-string">'name'</span>]);
<span class="hljs-keyword">exit</span>;
</code></pre>
    <p><strong>result.php</strong></p>
    <pre><code class="language-php">&lt;h1&gt;SUCCESS!&lt;/h1&gt;
&lt;p&gt;
  Welcome,
  <span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> $_GET[<span class="hljs-string">'name'</span>]; <span class="hljs-meta">?&gt;</span>
&lt;/p&gt;
</code></pre>
  </body>
</html>
